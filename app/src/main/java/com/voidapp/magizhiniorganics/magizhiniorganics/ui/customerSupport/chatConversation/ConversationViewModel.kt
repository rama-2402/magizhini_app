package com.voidapp.magizhiniorganics.magizhiniorganics.ui.customerSupport.chatConversationimport android.net.Uriimport androidx.lifecycle.LiveDataimport androidx.lifecycle.MutableLiveDataimport androidx.lifecycle.ViewModelimport androidx.lifecycle.viewModelScopeimport com.voidapp.magizhiniorganics.magizhiniorganics.Firestore.FirebaseRepositoryimport com.voidapp.magizhiniorganics.magizhiniorganics.Firestore.FirestoreRepositoryimport com.voidapp.magizhiniorganics.magizhiniorganics.data.dao.DatabaseRepositoryimport com.voidapp.magizhiniorganics.magizhiniorganics.data.models.Messagesimport com.voidapp.magizhiniorganics.magizhiniorganics.data.models.NotificationDataimport com.voidapp.magizhiniorganics.magizhiniorganics.data.models.PushNotificationimport com.voidapp.magizhiniorganics.magizhiniorganics.data.models.SupportProfileimport kotlinx.coroutines.Dispatchersimport kotlinx.coroutines.launchimport kotlinx.coroutines.withContextimport java.sql.Timestampclass ConversationViewModel(    private val dbRepository: DatabaseRepository,    private val fsRepository: FirestoreRepository,    private val fbRepository: FirebaseRepository): ViewModel() {    private var _conversation: MutableLiveData<Messages> = MutableLiveData()    val conversation: LiveData<Messages> = _conversation    private var _supportProfileStatus: MutableLiveData<SupportProfile> = MutableLiveData()    val supportProfileStatus: LiveData<SupportProfile> = _supportProfileStatus    private var _keyboardVisibile: MutableLiveData<Boolean> = MutableLiveData()    val keyboardVisibile: LiveData<Boolean> = _keyboardVisibile    private var _imageUploadStatus: MutableLiveData<String> = MutableLiveData()    val imageUploadStatus: LiveData<String> = _imageUploadStatus    private var _imageUrl: MutableLiveData<String> = MutableLiveData()    val imageUrl: LiveData<String> = _imageUrl    var currentUserName: String = ""    fun getConversation(fromId: String, toId: String) = fbRepository.getConversation(this, fromId, toId)    fun sendMessage(message: Messages) {        fbRepository.sendMessage(message)    }    fun openImage(url: String) {        _imageUrl.value = url    }    fun displayChatMessages(messages: Messages) {        _conversation.value = messages    }    fun getSupportProfileUpdates(id: String) = fbRepository.getSupportProfileUpdates(this, id)    fun updateTypingStatus(id: String ,status: Boolean) {        fbRepository.updateTypingStatus(id, status)    }    fun updateProfileStatus(id: String, status: Boolean, timestamp: Long = 0L) = fbRepository.updateProfileStatus(id, status, timestamp)    fun updateSupportProfileStatus(profile: SupportProfile?) {        _supportProfileStatus.value = profile    }    fun uploadImageToStorage(id: String ,uri: Uri, extension: String) =viewModelScope.launch(Dispatchers.IO) {        val path = "users/chat/$id"        val status = fsRepository.uploadImage(path, uri, extension)        if (            status == "failed"        ) {            withContext(Dispatchers.Main) {                _imageUploadStatus.value = "failed"            }        } else {            withContext(Dispatchers.Main) {                _imageUploadStatus.value = status            }        }    }    fun hideKeyboard(state: Boolean) {        _keyboardVisibile.value = state    }}